<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Rilke: Das Karussell (Fixed)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
        body { margin: 0; background-color: #000; font-family: sans-serif; }
        
        /* The Start Button Overlay */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; color: white;
        }
        button {
            padding: 20px 40px; font-size: 1.5rem; cursor: pointer;
            background: #fff; border: none; border-radius: 5px; margin-top: 20px;
        }
        button:hover { background: #ddd; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>Das Karussell</h1>
        <p>Click below to load Audio and Visuals</p>
        <button id="btn-start">Start Experience</button>
    </div>

    <script>
        // 1. VOICE AND AUDIO ENGINE
        let voice = null;
        let audioCtx = null;

        // Try to load German voice immediately
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            // Try to find a German voice, fallback to first available
            voice = voices.find(v => v.lang.includes('de')) || voices[0];
        }
        window.speechSynthesis.onvoiceschanged = loadVoices;

        // Music / Ambience Generator
        function startAmbience() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            
            // Simple low drone (Cello-like)
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.value = 55; // Low A
            gain.gain.value = 0.1;
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
        }

        // Poem Reader
        function readPoem() {
            const lines = [
                "Mit einem Dach und seinem Schatten dreht sich eine kleine Weile der Bestand",
                "von bunten Pferden, alle aus dem Land, das lange zögert, eh es untergeht.",
                "Zwar manche sind an Wagen angespannt, doch alle haben Mut in ihren Mienen;",
                "ein böser roter Löwe geht mit ihnen und dann ein ganz weißer Elefant.",
                "Sogar ein Hirsch ist da, ganz wie im Wald, nur daß er einen Sattel trägt und drüber ein kleines blaues Mädchen aufgeschnallt.",
                "Und dann ein böser roter Löwe. Und dann ein ganz weißer Elefant.",
                "Und das geht hin und eilt sich, daß es endet, und kreist und dreht sich nur und hat kein Ziel.",
                "Ein Rot, ein Grün, ein Grau vorbeigesendet, ein kleines kaum begonnenes Profil.",
                "Und manchesmal ein Lächeln, hergewendet, ein seliges, das blendet und verschwendet an dieses atemlose blinde Spiel."
            ];

            let i = 0;
            function nextLine() {
                if(i >= lines.length) return;
                const u = new SpeechSynthesisUtterance(lines[i]);
                if(voice) u.voice = voice;
                u.rate = 0.8; 
                u.pitch = 0.9;
                u.onend = () => {
                    i++;
                    setTimeout(nextLine, 1500); // Pause between lines
                };
                window.speechSynthesis.speak(u);
            }
            nextLine();
        }

        // Start Button Logic
        document.addEventListener('DOMContentLoaded', () => {
            loadVoices(); // Try loading voices again
            document.getElementById('btn-start').addEventListener('click', function() {
                document.getElementById('overlay').style.display = 'none';
                startAmbience();
                // Short delay to ensure browser audio context is ready
                setTimeout(readPoem, 500); 
            });
        });
    </script>

    <a-scene background="color: #000">

        <a-assets>
            <a-mixin id="bounce" animation="property: position; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine; from: 0 0 0; to: 0 0.5 0"></a-mixin>
            <a-mixin id="text-style" text="font: kelsonsans; align: center; width: 6; color: #fff; wrapCount: 30"></a-mixin>
        </a-assets>

        <a-sky color="#050510"></a-sky>

        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#111"></a-plane>

        <a-entity light="type: ambient; color: #888; intensity: 0.5"></a-entity>
        <a-entity light="type: point; intensity: 1; distance: 20; color: #ffcc00" position="0 4 0"></a-entity>

        <a-entity position="0 3 8" rotation="0 0 0">
            <a-plane width="7" height="3" color="#000" opacity="0.6"></a-plane>
            <a-entity mixin="text-style" text="value: Mit einem Dach und seinem Schatten dreht\nsich eine kleine Weile der Bestand\nvon bunten Pferden, alle aus dem Land,\ndas lange zögert, eh es untergeht."></a-entity>
        </a-entity>

        <a-entity position="6 3 6" rotation="0 -45 0">
            <a-plane width="7" height="3" color="#000" opacity="0.6"></a-plane>
            <a-entity mixin="text-style" text="value: Ein böser roter Löwe geht mit ihnen\nund dann ein ganz weißer Elefant."></a-entity>
        </a-entity>

        <a-entity position="-6 3 6" rotation="0 45 0">
            <a-plane width="7" height="3" color="#000" opacity="0.6"></a-plane>
            <a-entity mixin="text-style" text="value: Und das geht hin und eilt sich, daß es endet,\nund kreist und dreht sich nur und hat kein Ziel."></a-entity>
        </a-entity>

        <a-entity position="0 0 0" animation="property: rotation; to: 0 -360 0; loop: true; dur: 20000; easing: linear">
            
            <a-cylinder color="#555" height="5" radius="0.2" position="0 2.5 0"></a-cylinder>
            <a-cone color="#333" height="2" radius-bottom="6" position="0 5 0"></a-cone>
            <a-cylinder color="#222" height="0.2" radius="6" position="0 0.1 0"></a-cylinder>

            <a-entity rotation="0 0 0">
                <a-entity position="4 1 0">
                     <a-box color="red" depth="2" height="1.5" width="1"></a-box>
                </a-entity>
            </a-entity>

            <a-entity rotation="0 120 0">
                <a-entity position="4 1 0">
                    <a-sphere color="white" radius="1.2"></a-sphere>
                </a-entity>
            </a-entity>

            <a-entity rotation="0 240 0">
                <a-entity position="4 1 0">
                    <a-cylinder color="brown" height="1" radius="0.3"></a-cylinder>
                    <a-sphere color="blue" radius="0.5" position="0 1 0"></a-sphere>
                </a-entity>
            </a-entity>
        </a-entity>

        <a-entity position="0 1.6 12">
            <a-camera look-controls wasd-controls>
                <a-cursor color="yellow"></a-cursor>
            </a-camera>
        </a-entity>

    </a-scene>
</body>
</html>
