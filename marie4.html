<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Villa der Genies: Historische Pers√∂nlichkeiten verstehen</title>
<style>
  * { box-sizing: border-box; }
  
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 0; 
    padding: 0; 
    min-height: 100vh;
  }

  @keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
  }

  @keyframes slideIn {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  #introScreen { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
    text-align: center; 
    z-index: 10;
    color: white;
    padding: 20px;
  }

  #introScreen h1 { 
    font-size: 48px; 
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    animation: float 3s ease-in-out infinite;
  }

  #introScreen .subtitle {
    font-size: 24px;
    margin-bottom: 30px;
    opacity: 0.9;
  }

  .goal-box {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    max-width: 600px;
    margin: 20px auto;
    border: 2px solid rgba(255,255,255,0.3);
  }

  .goal-box h2 {
    font-size: 28px;
    margin-top: 0;
    color: #ffd700;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  }

  .goal-box p {
    font-size: 18px;
    line-height: 1.6;
    margin: 10px 0;
  }

  .goal-list {
    text-align: left;
    margin: 15px 0;
  }

  .goal-list li {
    margin: 8px 0;
    font-size: 16px;
  }

  #villaContainer { 
    display: none; 
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
  }

  #topBar {
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }

  #dayCounter {
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
  }

  #missionTracker {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: bold;
    color: #333;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  #badgeCollection {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .badge {
    font-size: 32px;
    animation: sparkle 2s infinite;
    cursor: pointer;
    position: relative;
    filter: grayscale(100%);
    opacity: 0.3;
    transition: all 0.3s;
  }

  .badge.earned {
    filter: grayscale(0%);
    opacity: 1;
    animation: pulse 1s ease-in-out;
  }

  .badge-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    z-index: 100;
  }

  .badge:hover .badge-tooltip {
    opacity: 1;
  }

  #villa { 
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .islander { 
    border: 3px solid #333;
    padding: 15px;
    text-align: center;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    animation: slideIn 0.5s ease-out;
    position: relative;
  }

  .islander:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 12px rgba(0,0,0,0.2);
  }

  .islander.highlighted {
    border-color: #ffd700;
    box-shadow: 0 0 20px rgba(255,215,0,0.5);
  }

  .emoji { 
    font-size: 48px; 
    margin-bottom: 10px;
    animation: float 3s ease-in-out infinite;
  }

  .personality-trait {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    margin: 5px 2px;
    display: inline-block;
  }

  .stat-bar {
    background: #f0f0f0;
    height: 20px;
    border-radius: 10px;
    margin: 5px 0;
    overflow: hidden;
    position: relative;
  }

  .stat-fill {
    height: 100%;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: white;
    font-weight: bold;
  }

  .stat-charm { background: linear-gradient(90deg, #ff6b6b, #ff8e8e); }
  .stat-intellect { background: linear-gradient(90deg, #4ecdc4, #6eddd6); }
  .stat-passion { background: linear-gradient(90deg, #ff6b9d, #ff8eb3); }

  .rel-bar { 
    height: 8px;
    background: #ddd;
    margin: 3px 0;
    border-radius: 5px;
    overflow: hidden;
    position: relative;
  }

  .rel-fill {
    height: 100%;
    transition: width 0.5s ease;
  }

  .rel-positive { background: linear-gradient(90deg, #ff6b9d, #c44569); }
  .rel-negative { background: linear-gradient(90deg, #95a5a6, #7f8c8d); }

  .controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  button { 
    padding: 15px 30px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 10px;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    font-weight: bold;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }

  .btn-success {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }

  #storyLog { 
    background: white;
    padding: 20px;
    border-radius: 15px;
    height: 400px;
    overflow-y: auto;
    font-size: 16px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-top: 20px;
  }

  .story-entry {
    margin: 10px 0;
    padding: 10px;
    border-radius: 8px;
    animation: slideIn 0.3s ease-out;
  }

  .flirt { 
    background: linear-gradient(135deg, #ffe5ec 0%, #ffd1dc 100%);
    border-left: 4px solid #ff6b9d;
    color: #c44569;
  }

  .insight {
    background: linear-gradient(135deg, #e0f7ff 0%, #b3e5fc 100%);
    border-left: 4px solid #4ecdc4;
    color: #006064;
    font-style: italic;
  }

  .drama { 
    background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
    border-left: 4px solid #f44336;
    color: #c62828;
  }

  .strategy { 
    background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
    border-left: 4px solid #5c6bc0;
    color: #283593;
  }

  .twist { 
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-left: 4px solid #ff9800;
    color: #e65100;
    font-weight: bold;
  }

  .mission-complete {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    border-left: 4px solid #f57f17;
    color: #f57f17;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
    animation: pulse 0.5s ease-in-out 3;
  }

  .info-card {
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .info-card h3 {
    margin-top: 0;
    color: #667eea;
  }

  #missionPanel {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .mission-item {
    display: flex;
    align-items: center;
    padding: 10px;
    margin: 5px 0;
    border-radius: 8px;
    background: #f5f5f5;
    transition: all 0.3s;
  }

  .mission-item.complete {
    background: linear-gradient(135deg, #d4f1d4 0%, #c8e6c9 100%);
  }

  .mission-checkbox {
    font-size: 24px;
    margin-right: 15px;
  }

  .historical-note {
    background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
    border-left: 4px solid #fbc02d;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.5;
  }

  .character-revelation {
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
    border: 2px solid #9c27b0;
    padding: 15px;
    margin: 15px 0;
    border-radius: 10px;
    font-weight: 500;
  }

  @media (max-width: 768px) {
    #introScreen h1 { font-size: 32px; }
    .goal-box { padding: 15px; }
    #topBar { flex-direction: column; }
    button { padding: 12px 20px; font-size: 16px; }
  }
</style>
</head>
<body>

<div id="introScreen">
  <h1>üèõÔ∏è Villa der Genies üèõÔ∏è</h1>
  <div class="subtitle">Historische Pers√∂nlichkeiten besser verstehen</div>
  
  <div class="goal-box">
    <h2>üéØ Deine Mission</h2>
    <p><strong>Verstehe die Pers√∂nlichkeiten hinter den Namen!</strong></p>
    <p>In dieser Villa treffen sich die gr√∂√üten Denker, K√ºnstler und F√ºhrungspers√∂nlichkeiten der Geschichte. Deine Aufgabe ist es, ihre Charaktereigenschaften, Motivationen und Beziehungsdynamiken zu entdecken.</p>
    
    <div class="goal-list">
      <ul>
        <li>üìö <strong>Lerne:</strong> Entdecke, was diese Pers√∂nlichkeiten antrieb</li>
        <li>ü§ù <strong>Beobachte:</strong> Wie w√ºrden sie miteinander interagieren?</li>
        <li>üèÜ <strong>Sammle:</strong> Verdiene Abzeichen f√ºr historische Erkenntnisse</li>
        <li>üí° <strong>Verstehe:</strong> Warum Einstein anders dachte als Napoleon</li>
      </ul>
    </div>
    
    <p style="font-size: 16px; margin-top: 20px;">
      <em>Jede Interaktion enth√ºllt tiefere Einblicke in die Pers√∂nlichkeitstypen dieser historischen Figuren!</em>
    </p>
  </div>
  
  <button onclick="startSeason()">üé¨ Staffel starten</button>
</div>

<div id="villaContainer">
  <div id="topBar">
    <div id="dayCounter">Tag 1 von 10</div>
    <div id="missionTracker">Mission: 0/5 Abzeichen gesammelt</div>
    <div id="badgeCollection">
      <div class="badge" data-badge="observer">
        üîç
        <div class="badge-tooltip">Beobachter: 10 Interaktionen beobachtet</div>
      </div>
      <div class="badge" data-badge="psychologist">
        üß†
        <div class="badge-tooltip">Psychologe: Alle Pers√∂nlichkeitstypen verstanden</div>
      </div>
      <div class="badge" data-badge="historian">
        üìú
        <div class="badge-tooltip">Historiker: 5 historische Fakten entdeckt</div>
      </div>
      <div class="badge" data-badge="matchmaker">
        üíï
        <div class="badge-tooltip">Kuppler: 3 erfolgreiche Paare gebildet</div>
      </div>
      <div class="badge" data-badge="philosopher">
        ‚≠ê
        <div class="badge-tooltip">Philosoph: Staffel abgeschlossen</div>
      </div>
    </div>
  </div>

  <div id="missionPanel">
    <h2 style="margin-top: 0; color: #667eea;">üìã Aktuelle Missionen</h2>
    <div class="mission-item" id="mission-observe">
      <span class="mission-checkbox">‚¨ú</span>
      <span>Beobachte 10 Interaktionen zwischen den Genies</span>
    </div>
    <div class="mission-item" id="mission-couples">
      <span class="mission-checkbox">‚¨ú</span>
      <span>Bilde 3 erfolgreiche Paare basierend auf Pers√∂nlichkeiten</span>
    </div>
    <div class="mission-item" id="mission-insights">
      <span class="mission-checkbox">‚¨ú</span>
      <span>Entdecke 5 historische Erkenntnisse</span>
    </div>
    <div class="mission-item" id="mission-einstein">
      <span class="mission-checkbox">‚¨ú</span>
      <span>Verstehe Einsteins einzigartige Perspektive</span>
    </div>
  </div>

  <div id="villa"></div>

  <div class="controls">
    <button id="advanceBtn" onclick="nextDay()">‚è≠Ô∏è N√§chster Tag</button>
    <button id="challengeBtn" class="btn-secondary" onclick="triggerChallenge()">üéØ Challenge starten</button>
    <button id="insightBtn" class="btn-success" onclick="requestInsight()">üí° Historische Einsicht</button>
  </div>

  <h2 style="text-align: center; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üìñ Story-Protokoll & Erkenntnisse</h2>
  <div id="storyLog"></div>
</div>

<script>
// Enhanced character data with personality traits
const islanders = [
  { 
    name: "Albert Einstein", 
    emoji: "üßë‚Äçüî¨", 
    stats: { charm: 7, intellect: 10, passion: 8 }, 
    relationships: {},
    traits: ["Vision√§r", "Pazifist", "Querdenker"],
    historicalFact: "Einstein lehnte Autorit√§t ab und glaubte an kreatives Denken statt stures Auswendiglernen."
  },
  { 
    name: "Cleopatra", 
    emoji: "üëë", 
    stats: { charm: 10, intellect: 9, passion: 9 }, 
    relationships: {},
    traits: ["Strategisch", "Charismatisch", "Gebildet"],
    historicalFact: "Cleopatra sprach neun Sprachen und war die erste Ptolem√§erin, die √Ñgyptisch lernte."
  },
  { 
    name: "Napoleon Bonaparte", 
    emoji: "‚öîÔ∏è", 
    stats: { charm: 6, intellect: 9, passion: 7 }, 
    relationships: {},
    traits: ["Strategisch", "Ehrgeizig", "Reformer"],
    historicalFact: "Napoleon reformierte das franz√∂sische Rechtssystem und schuf den Code Civil, der heute noch gilt."
  },
  { 
    name: "Frida Kahlo", 
    emoji: "üé®", 
    stats: { charm: 8, intellect: 8, passion: 10 }, 
    relationships: {},
    traits: ["Leidenschaftlich", "Resilient", "Authentisch"],
    historicalFact: "Frida verwandelte ihren Schmerz in Kunst und wurde zum Symbol f√ºr Authentizit√§t und Widerstandsf√§higkeit."
  },
  { 
    name: "Leonardo da Vinci", 
    emoji: "üñåÔ∏è", 
    stats: { charm: 8, intellect: 10, passion: 9 }, 
    relationships: {},
    traits: ["Universalgenie", "Neugierig", "Perfektionist"],
    historicalFact: "Leonardo war Maler, Erfinder, Anatom und Ingenieur - das ultimative Renaissance-Genie."
  },
  { 
    name: "Marilyn Monroe", 
    emoji: "üíÉ", 
    stats: { charm: 10, intellect: 7, passion: 8 }, 
    relationships: {},
    traits: ["Charismatisch", "Komplex", "Verletzlich"],
    historicalFact: "Hinter dem Star-Image war Monroe eine intelligente Leserin und gesch√§ftsbewusste Unternehmerin."
  }
];

const bombshellBank = [
  { 
    name: "Nikola Tesla", 
    emoji: "‚ö°", 
    stats: { charm: 7, intellect: 10, passion: 8 },
    traits: ["Vision√§r", "Einzelg√§nger", "Idealist"],
    historicalFact: "Tesla tr√§umte von kostenloser Energie f√ºr alle und arbeitete oft 20 Stunden am Tag."
  },
  { 
    name: "Marie Curie", 
    emoji: "üß™", 
    stats: { charm: 7, intellect: 10, passion: 9 },
    traits: ["Beharrlich", "Pionier", "Bescheiden"],
    historicalFact: "Marie Curie war die erste Frau, die einen Nobelpreis gewann - und gewann sogar zwei!"
  },
  { 
    name: "Oscar Wilde", 
    emoji: "üñãÔ∏è", 
    stats: { charm: 10, intellect: 9, passion: 8 },
    traits: ["Witzig", "Provokant", "√Ñsthet"],
    historicalFact: "Wilde benutzte Humor und Satire, um gesellschaftliche Heuchelei zu entlarven."
  },
  { 
    name: "Joan of Arc", 
    emoji: "üó°Ô∏è", 
    stats: { charm: 7, intellect: 7, passion: 10 },
    traits: ["Mutig", "Entschlossen", "Idealistisch"],
    historicalFact: "Mit nur 17 Jahren f√ºhrte Jeanne d'Arc franz√∂sische Truppen zum Sieg - getrieben von ihrem Glauben."
  }
];

// Initialize relationships
islanders.forEach(i => { 
  islanders.forEach(j => { 
    if(i !== j) i.relationships[j.name] = 0; 
  }); 
});

let currentDay = 1;
const totalDays = 10;
let interactionCount = 0;
let couplesFormed = 0;
let insightsRevealed = 0;
let einsteinInsightRevealed = false;
let challengesCompleted = 0;

const badges = {
  observer: false,
  psychologist: false,
  historian: false,
  matchmaker: false,
  philosopher: false
};

// Historical insights
const historicalInsights = [
  {
    type: "Einstein",
    text: "üß† <strong>Einstein-Einsicht:</strong> Einstein war kein typischer Wissenschaftler. Er dachte in Bildern und Gedankenexperimenten, nicht nur in Formeln. Seine gr√∂√üte St√§rke war die F√§higkeit, komplexe Konzepte einfach zu visualisieren.",
    character: "Albert Einstein"
  },
  {
    type: "Cleopatra",
    text: "üëë <strong>Cleopatra-Einsicht:</strong> Cleopatra war nicht nur sch√∂n - sie war politisch brilliant. Sie nutzte Bildung und Diplomatie als Waffen und verstand, dass Macht durch Beziehungen gesichert wird.",
    character: "Cleopatra"
  },
  {
    type: "Napoleon",
    text: "‚öîÔ∏è <strong>Napoleon-Einsicht:</strong> Napoleons St√§rke lag in seiner F√§higkeit, Details zu meistern. Er kannte jeden seiner Gener√§le pers√∂nlich und konnte komplexe milit√§rische Operationen im Kopf koordinieren.",
    character: "Napoleon Bonaparte"
  },
  {
    type: "Frida",
    text: "üé® <strong>Frida-Einsicht:</strong> Fridas Kunst war zutiefst pers√∂nlich. Sie verwandelte k√∂rperlichen und emotionalen Schmerz in kraftvolle Selbstportr√§ts, die ihre innere Wahrheit zeigten.",
    character: "Frida Kahlo"
  },
  {
    type: "Leonardo",
    text: "üñåÔ∏è <strong>Leonardo-Einsicht:</strong> Leonardos Neugier kannte keine Grenzen. Er sezierte Leichen, um Anatomie zu verstehen, studierte V√∂gel f√ºr Flugmaschinen und war besessen von Perfektion.",
    character: "Leonardo da Vinci"
  },
  {
    type: "Marilyn",
    text: "üíÉ <strong>Marilyn-Einsicht:</strong> Marilyn Monroe war mehr als ein 'Dumb Blonde'. Sie gr√ºndete ihre eigene Produktionsfirma und k√§mpfte f√ºr kreative Kontrolle in einer von M√§nnern dominierten Industrie.",
    character: "Marilyn Monroe"
  }
];

let availableInsights = [...historicalInsights];

function startSeason() {
  document.getElementById('introScreen').style.display = 'none';
  document.getElementById('villaContainer').style.display = 'block';
  displayVilla();
  addToStoryLog(`<div class="twist">üé¨ Tag 1 beginnt! Willkommen in der Villa der Genies! Deine Mission: Verstehe die Pers√∂nlichkeiten dieser historischen Figuren durch ihre Interaktionen.</div>`);
}

function displayVilla() {
  const villaDiv = document.getElementById("villa");
  villaDiv.innerHTML = "";
  
  islanders.forEach(i => {
    let statBars = `
      <div class="stat-bar">
        <div class="stat-fill stat-charm" style="width: ${i.stats.charm * 10}%">Charme: ${i.stats.charm}</div>
      </div>
      <div class="stat-bar">
        <div class="stat-fill stat-intellect" style="width: ${i.stats.intellect * 10}%">Intellekt: ${i.stats.intellect}</div>
      </div>
      <div class="stat-bar">
        <div class="stat-fill stat-passion" style="width: ${i.stats.passion * 10}%">Leidenschaft: ${i.stats.passion}</div>
      </div>
    `;
    
    let traits = i.traits.map(t => `<span class="personality-trait">${t}</span>`).join('');
    
    let relBars = "";
    for(let key in i.relationships) {
      let val = i.relationships[key];
      let width = Math.max(0, Math.min(100, 50 + val * 5));
      let isPositive = val > 0;
      relBars += `
        <div class="rel-bar">
          <div class="rel-fill ${isPositive ? 'rel-positive' : 'rel-negative'}" 
               style="width: ${width}%" 
               title="${key}: ${val > 0 ? '+' : ''}${val}">
          </div>
        </div>`;
    }
    
    villaDiv.innerHTML += `
      <div class="islander" data-name="${i.name}">
        <div class="emoji">${i.emoji}</div>
        <strong>${i.name}</strong><br>
        ${traits}
        <div style="margin-top: 10px;">
          ${statBars}
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #666;">
          <strong>Beziehungen:</strong>
          ${relBars}
        </div>
      </div>
    `;
  });
}

function addToStoryLog(text) {
  const log = document.getElementById("storyLog");
  log.innerHTML += text;
  log.scrollTop = log.scrollHeight;
  displayVilla();
  updateMissions();
}

function updateMissions() {
  document.getElementById('dayCounter').textContent = `Tag ${currentDay} von ${totalDays}`;
  
  // Update mission tracker
  const earnedBadges = Object.values(badges).filter(b => b).length;
  document.getElementById('missionTracker').textContent = `Mission: ${earnedBadges}/5 Abzeichen gesammelt`;
  
  // Update individual missions
  if (interactionCount >= 10) {
    document.getElementById('mission-observe').classList.add('complete');
    document.getElementById('mission-observe').querySelector('.mission-checkbox').textContent = '‚úÖ';
    if (!badges.observer) {
      badges.observer = true;
      awardBadge('observer');
    }
  }
  
  if (couplesFormed >= 3) {
    document.getElementById('mission-couples').classList.add('complete');
    document.getElementById('mission-couples').querySelector('.mission-checkbox').textContent = '‚úÖ';
    if (!badges.matchmaker) {
      badges.matchmaker = true;
      awardBadge('matchmaker');
    }
  }
  
  if (insightsRevealed >= 5) {
    document.getElementById('mission-insights').classList.add('complete');
    document.getElementById('mission-insights').querySelector('.mission-checkbox').textContent = '‚úÖ';
    if (!badges.historian) {
      badges.historian = true;
      awardBadge('historian');
    }
  }
  
  if (einsteinInsightRevealed) {
    document.getElementById('mission-einstein').classList.add('complete');
    document.getElementById('mission-einstein').querySelector('.mission-checkbox').textContent = '‚úÖ';
    if (!badges.psychologist) {
      badges.psychologist = true;
      awardBadge('psychologist');
    }
  }
}

function awardBadge(badgeType) {
  const badgeElement = document.querySelector(`.badge[data-badge="${badgeType}"]`);
  badgeElement.classList.add('earned');
  addToStoryLog(`<div class="mission-complete">üèÜ Neues Abzeichen freigeschaltet: ${badgeElement.textContent} ${badgeElement.querySelector('.badge-tooltip').textContent}</div>`);
}

function requestInsight() {
  if (availableInsights.length === 0) {
    addToStoryLog(`<div class="historical-note">üìö Du hast bereits alle historischen Einsichten entdeckt! Gro√üartige Arbeit!</div>`);
    return;
  }
  
  const insight = availableInsights.splice(Math.floor(Math.random() * availableInsights.length), 1)[0];
  insightsRevealed++;
  
  if (insight.character === "Albert Einstein") {
    einsteinInsightRevealed = true;
  }
  
  // Highlight the character
  document.querySelectorAll('.islander').forEach(el => {
    if (el.dataset.name === insight.character) {
      el.classList.add('highlighted');
      setTimeout(() => el.classList.remove('highlighted'), 3000);
    }
  });
  
  addToStoryLog(`<div class="character-revelation">${insight.text}</div>`);
  
  // Add contextual interaction
  const character = islanders.find(i => i.name === insight.character);
  if (character) {
    addToStoryLog(`<div class="insight">üí≠ Diese Eigenschaft erkl√§rt, warum ${character.name} so ${character.traits[0].toLowerCase()} ist!</div>`);
  }
  
  updateMissions();
}

function formCouples() {
  const paired = new Set();
  let newCouples = 0;
  
  islanders.forEach(i => {
    if (paired.has(i.name)) return;
    
    let topChoice = null;
    let maxRel = -Infinity;
    
    for (let key in i.relationships) {
      if (!paired.has(key) && i.relationships[key] > maxRel) {
        maxRel = i.relationships[key];
        topChoice = key;
      }
    }
    
    if (topChoice && maxRel > 5) {
      const j = islanders.find(x => x.name === topChoice);
      const jTopName = Object.entries(j.relationships).reduce((a, b) => b[1] > a[1] ? b : a)[0];
      
      if (jTopName === i.name) {
        paired.add(i.name);
        paired.add(j.name);
        i.relationships[j.name] += 3;
        j.relationships[i.name] += 3;
        couplesFormed++;
        newCouples++;
        
        const reason = explainConnection(i, j);
        addToStoryLog(`<div class="flirt">üíï ${i.name} ${i.emoji} und ${j.name} ${j.emoji} haben sich als Paar zusammengeschlossen! <br><em>${reason}</em></div>`);
        
        interactionCount++;
      }
    }
  });
  
  updateMissions();
}

function explainConnection(person1, person2) {
  const reasons = [
    `Beide sch√§tzen ${person1.traits[0].toLowerCase()} Pers√∂nlichkeiten`,
    `Ihre intellektuelle Kompatibilit√§t ist offensichtlich`,
    `${person1.name}s ${person1.traits[1].toLowerCase()}e Art harmoniert perfekt mit ${person2.name}`,
    `Gegens√§tze ziehen sich an - ihre unterschiedlichen St√§rken erg√§nzen sich`,
    `Sie teilen eine tiefe Leidenschaft f√ºr ihre jeweiligen Felder`
  ];
  return reasons[Math.floor(Math.random() * reasons.length)];
}

function addBombshell() {
  if (bombshellBank.length === 0) return;
  
  const index = Math.floor(Math.random() * bombshellBank.length);
  const newBombshell = bombshellBank.splice(index, 1)[0];
  newBombshell.relationships = {};
  
  islanders.forEach(i => {
    newBombshell.relationships[i.name] = 0;
    i.relationships[newBombshell.name] = 0;
  });
  
  islanders.push(newBombshell);
  displayVilla();
  
  addToStoryLog(`<div class="twist">üí• Neue Bombshell! ${newBombshell.emoji} ${newBombshell.name} betritt die Villa!</div>`);
  addToStoryLog(`<div class="historical-note">üìö Historischer Fakt: ${newBombshell.historicalFact}</div>`);
  
  interactionCount++;
  updateMissions();
}

function randomEvent() {
  const i1 = islanders[Math.floor(Math.random() * islanders.length)];
  let i2;
  do {
    i2 = islanders[Math.floor(Math.random() * islanders.length)];
  } while (i2 === i1);
  
  const events = [
    () => {
      i1.relationships[i2.name] += 3;
      interactionCount++;
      return `<div class="flirt">üíò ${i1.name} und ${i2.name} f√ºhren ein tiefgr√ºndiges Gespr√§ch. ${i1.name}s ${i1.traits[0].toLowerCase()}e Natur kommt gut an! (+3)</div>`;
    },
    () => {
      i1.relationships[i2.name] -= 2;
      interactionCount++;
      return `<div class="drama">‚ö° ${i1.name} und ${i2.name} geraten aneinander - ihre unterschiedlichen Pers√∂nlichkeiten prallen aufeinander! (-2)</div>`;
    },
    () => {
      i1.relationships[i2.name] += 2;
      interactionCount++;
      const insight = `${i1.name}s ${i1.traits[0].toLowerCase()}e Art findet Respekt bei ${i2.name}`;
      return `<div class="strategy">ü§ù ${i1.name} hilft ${i2.name} bei einer Challenge. ${insight} (+2)</div>`;
    },
    () => {
      interactionCount++;
      return `<div class="insight">üí≠ ${i1.name} teilt eine pers√∂nliche Geschichte √ºber ${i1.traits[1].toLowerCase()}e Erfahrungen - die anderen sind fasziniert!</div>`;
    },
    () => {
      i1.relationships[i2.name] += 4;
      interactionCount++;
      return `<div class="flirt">‚ú® ${i1.name} und ${i2.name} entdecken eine gemeinsame Leidenschaft! Ihre Beziehung vertieft sich. (+4)</div>`;
    }
  ];
  
  return events[Math.floor(Math.random() * events.length)]();
}

function triggerChallenge() {
  if (challengesCompleted >= 15) {
    addToStoryLog(`<div class="drama">‚è∏Ô∏è Genug Challenges f√ºr heute - lass die Beziehungen sich entwickeln!</div>`);
    return;
  }
  
  challengesCompleted++;
  const i1 = islanders[Math.floor(Math.random() * islanders.length)];
  let i2;
  do {
    i2 = islanders[Math.floor(Math.random() * islanders.length)];
  } while (i2 === i1);
  
  const challenges = [
    {
      name: "üß† Intellekt-Duell",
      outcomes: [
        () => {
          i1.relationships[i2.name] += 3;
          interactionCount++;
          return `${i1.name} brilliert im Intellekt-Duell und beeindruckt ${i2.name} mit ${i1.traits[0].toLowerCase()}en Einsichten! (+3)`;
        },
        () => {
          i2.relationships[i1.name] += 3;
          interactionCount++;
          return `${i2.name} zeigt √ºberraschende Tiefe und gewinnt ${i1.name}s Respekt! (+3 f√ºr ${i2.name})`;
        }
      ]
    },
    {
      name: "üé® Kreativit√§ts-Challenge",
      outcomes: [
        () => {
          i1.relationships[i2.name] += 3;
          i2.relationships[i1.name] += 3;
          interactionCount++;
          return `${i1.name} und ${i2.name} kreieren zusammen etwas Wunderbares - ihre ${i1.traits[0].toLowerCase()}e und ${i2.traits[0].toLowerCase()}e Naturen harmonieren perfekt! (+3 beide)`;
        },
        () => {
          i1.relationships[i2.name] += 2;
          interactionCount++;
          return `${i1.name}s ${i1.traits[1].toLowerCase()}er Ansatz beeindruckt ${i2.name}! (+2)`;
        }
      ]
    },
    {
      name: "üí¨ Tiefgr√ºndiges Gespr√§ch",
      outcomes: [
        () => {
          i1.relationships[i2.name] += 4;
          i2.relationships[i1.name] += 4;
          interactionCount++;
          return `${i1.name} und ${i2.name} haben ein bedeutungsvolles Gespr√§ch √ºber ihre Lebensmissionen. Beide f√ºhlen eine tiefe Verbindung! (+4 beide)`;
        },
        () => {
          i1.relationships[i2.name] -= 1;
          interactionCount++;
          return `${i1.name}s ${i1.traits[2].toLowerCase()}e Perspektive passt nicht zu ${i2.name}s Weltanschauung. (-1)`;
        }
      ]
    },
    {
      name: "üé≠ Pers√∂nlichkeits-Showcase",
      outcomes: [
        () => {
          i1.relationships[i2.name] += 3;
          interactionCount++;
          return `${i1.name} zeigt seine wahre, ${i1.traits[0].toLowerCase()}e Pers√∂nlichkeit - ${i2.name} ist begeistert! (+3)`;
        },
        () => {
          interactionCount++;
          return `${i1.name} √∂ffnet sich √ºber ihre ${i1.traits[1].toLowerCase()}e Seite - die Villa ist ber√ºhrt! üí´`;
        }
      ]
    }
  ];
  
  const chosen = challenges[Math.floor(Math.random() * challenges.length)];
  const outcome = chosen.outcomes[Math.floor(Math.random() * chosen.outcomes.length)]();
  
  addToStoryLog(`<div class="strategy"><strong>Challenge: ${chosen.name}</strong><br>${outcome}</div>`);
  updateMissions();
}

function triggerTwist() {
  const twists = [
    () => {
      addBombshell();
    },
    () => {
      const i = islanders[Math.floor(Math.random() * islanders.length)];
      addToStoryLog(`<div class="character-revelation">üåü ${i.name} hat eine Offenbarung: Als ${i.traits[0].toLowerCase()}e Person hat ${i.name} immer versucht, ${i.traits[1].toLowerCase()} zu sein, aber das wahre Genie liegt in der Authentizit√§t!</div>`);
      addToStoryLog(`<div class="historical-note">üìö ${i.historicalFact}</div>`);
      interactionCount++;
    },
    () => {
      const i = islanders[Math.floor(Math.random() * islanders.length)];
      islanders.forEach(j => {
        if (j !== i) i.relationships[j.name] += 2;
      });
      addToStoryLog(`<div class="twist">‚ú® ${i.name} hat einen magischen Moment! Ihre ${i.traits[0].toLowerCase()}e Art ber√ºhrt alle in der Villa. (+2 bei allen)</div>`);
      interactionCount++;
    }
  ];
  
  twists[Math.floor(Math.random() * twists.length)]();
}

function nextDay() {
  if (currentDay >= totalDays) {
    endSeason();
    return;
  }
  
  challengesCompleted = 0;
  
  formCouples();
  
  const eventsPerDay = 4;
  for (let i = 0; i < eventsPerDay; i++) {
    addToStoryLog(randomEvent());
  }
  
  if (Math.random() < 0.4) {
    triggerTwist();
  }
  
  currentDay++;
  updateMissions();
  
  // Scroll to top of story log
  document.getElementById('storyLog').scrollTop = 0;
}

function endSeason() {
  if (!badges.philosopher) {
    badges.philosopher = true;
    awardBadge('philosopher');
  }
  
  addToStoryLog(`<div class="twist"><h2>üèÜ STAFFELFINALE üèÜ</h2></div>`);
  addToStoryLog(`<div class="info-card"><h3>Was haben wir √ºber Pers√∂nlichkeiten gelernt?</h3></div>`);
  
  islanders.forEach(i => {
    let maxRel = { name: null, value: -Infinity };
    for (let key in i.relationships) {
      if (i.relationships[key] > maxRel.value) {
        maxRel = { name: key, value: i.relationships[key] };
      }
    }
    
    const partner = islanders.find(p => p.name === maxRel.name);
    let insight = "";
    if (partner) {
      insight = `Diese Verbindung zeigt, wie ${i.traits[0].toLowerCase()}e Menschen mit ${partner.traits[0].toLowerCase()}en Pers√∂nlichkeiten harmonieren k√∂nnen.`;
    }
    
    addToStoryLog(`<div class="info-card">
      <strong>${i.emoji} ${i.name}</strong> (${i.traits.join(", ")})<br>
      St√§rkste Verbindung: ${maxRel.name} (Wert: ${maxRel.value})<br>
      <em>${insight}</em><br>
      <div class="historical-note">üìö ${i.historicalFact}</div>
    </div>`);
  });
  
  let winner = islanders[0];
  islanders.forEach(i => {
    const total = Object.values(i.relationships).reduce((a, b) => a + b, 0);
    const winnerTotal = Object.values(winner.relationships).reduce((a, b) => a + b, 0);
    if (total > winnerTotal) winner = i;
  });
  
  addToStoryLog(`<div class="mission-complete">
    <h2>üèÜ Der Gewinner: ${winner.emoji} ${winner.name} üèÜ</h2>
    <p><strong>Warum ${winner.name} gewonnen hat:</strong></p>
    <p>${winner.name}s ${winner.traits[0].toLowerCase()}e und ${winner.traits[1].toLowerCase()}e Natur erm√∂glichte es, authentische Verbindungen mit unterschiedlichsten Pers√∂nlichkeitstypen aufzubauen!</p>
    <p><em>Das zeigt uns: Echte historische Gr√∂√üe kommt oft von der F√§higkeit, mit anderen zusammenzuarbeiten und sie zu verstehen.</em></p>
  </div>`);
  
  const earnedBadges = Object.values(badges).filter(b => b).length;
  addToStoryLog(`<div class="mission-complete">
    <h3>üéì Deine Lernerfolge</h3>
    <p>Du hast ${earnedBadges} von 5 Abzeichen verdient!</p>
    <p>Beobachtete Interaktionen: ${interactionCount}</p>
    <p>Gebildete Paare: ${couplesFormed}</p>
    <p>Entdeckte Einsichten: ${insightsRevealed}</p>
    <p><em>${earnedBadges === 5 ? 'Perfekt! Du bist ein wahrer Historiker der Pers√∂nlichkeiten!' : 'Starte eine neue Staffel, um mehr zu lernen!'}</em></p>
  </div>`);
  
  document.getElementById("advanceBtn").disabled = true;
  document.getElementById("advanceBtn").textContent = "‚úÖ Staffel beendet";
  document.getElementById("challengeBtn").disabled = true;
  document.getElementById("insightBtn").disabled = true;
}

// Initialize
updateMissions();
</script>

</body>
</html>
